<source>
  type forward
  port 24224
</source>

<match rails.docker.**>
  type parser
  key_name log
  format json
  add_prefix elastic1
</match>

<match nginx.docker.**>
  type parser
  key_name log
  format /^(?<remote_addr>[^ ]*) - (?<remote_user>[^ ]*) \[(?<time>[^\]]*)\] "(?<request_type>[^ ]*) (?<request_url>[^ ]*) (?<request_http_protocol>[^ ]*)" (?<status_code>[^ ]*) (?<request_size>[^ ]*) "(?<referer>[^\"]*)" "(?<user_agent>[^\"]*)" "(?<algo>[^\"]*)"?$/
  time_format %d/%b/%Y:%H:%M:%S %z
  reserve_data yes
  add_prefix elastic2
</match>

<match elastic1.**>
  type elasticsearch
  host elasticsearch
  logstash_format true
  logstash_prefix elastic1
  flush_interval 10s
</match>

<match elastic2.**>
  type elasticsearch
  host elasticsearch
  logstash_format true
  logstash_prefix elastic2
  flush_interval 10s
</match>
